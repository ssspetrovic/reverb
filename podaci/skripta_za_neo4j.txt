LOAD CSV WITH HEADERS FROM 'file:///spotify_songs.csv' AS row
CREATE (:Song {
    track_id: row.track_id,
    track_name: row.track_name,
    track_artist: row.track_artist,
    track_popularity: toInteger(row.track_popularity),
    track_album_id: row.track_album_id,
    track_album_name: row.track_album_name,
    track_album_release_date: row.track_album_release_date,
    playlist_name: row.playlist_name,
    playlist_id: row.playlist_id,
    playlist_genre: row.playlist_genre,
    playlist_subgenre: row.playlist_subgenre,
    danceability: toFloat(row.danceability),
    energy: toFloat(row.energy),
    key: toInteger(row.key),
    loudness: toFloat(row.loudness),
    mode: toInteger(row.mode),
    speechiness: toFloat(row.speechiness),
    acousticness: toFloat(row.acousticness),
    instrumentalness: toFloat(row.instrumentalness),
    liveness: toFloat(row.liveness),
    valence: toFloat(row.valence),
    tempo: toFloat(row.tempo),
    duration_ms: toInteger(row.duration_ms)
})


// Kreiranje klastera
CREATE (:Cluster {name: 'reverb_cluster'});

// Kreiranje kolekcija (nodova)
CREATE (:Collection {name: 'songs'});
CREATE (:Collection {name: 'artists'});
CREATE (:Collection {name: 'albums'});


// Dodavanje atributa za svaku kolekciju
MATCH (song:Song)
CREATE (:CollectionSong {
    track_id: song.track_id,
    track_name: song.track_name,
    track_artist: song.track_artist,
    track_popularity: song.track_popularity,
    track_album_id: song.track_album_id,
    track_album_name: song.track_album_name,
    track_album_release_date: song.track_album_release_date,
    playlist_name: song.playlist_name,
    playlist_id: song.playlist_id,
    playlist_genre: song.playlist_genre,
    playlist_subgenre: song.playlist_subgenre,
    danceability: song.danceability,
    energy: song.energy,
    key: song.key,
    loudness: song.loudness,
    mode: song.mode,
    speechiness: song.speechiness,
    acousticness: song.acousticness,
    instrumentalness: song.instrumentalness,
    liveness: song.liveness,
    valence: song.valence,
    tempo: song.tempo,
    duration_ms: song.duration_ms
})

//Indeks na ime
CREATE INDEX FOR (a:CollectionArtist) ON (a.name);


// Prenos podataka iz baze 'Song' u kolekciju 'artists'
MATCH (song:Song)
MERGE (artist:CollectionArtist {name: song.track_artist})
ON CREATE SET
    artist.artist_id = song.artist_id,
    artist.artist_name = song.artist_name,
    artist.artist_genre = song.artist_genre,
    artist.artist_popularity = song.artist_popularity

//Indeks na ime
CREATE INDEX FOR (a:CollectionAlbum) ON (a.name);


// Prenos podataka iz baze 'Song' u kolekciju 'albums'
MATCH (song:Song)
MERGE (album:CollectionAlbum {name: song.track_album_name})
ON CREATE SET
    album.album_id = song.album_id,
    album.album_name = song.album_name,
    album.album_artist = song.album_artist,
    album.album_release_date = song.album_release_date,
    album.album_total_tracks = song.album_total_tracks,
    album.album_popularity = song.album_popularity


// Formiranje indeksa za track_id polje u kolekciji pesama
CREATE INDEX FOR (s:Song) ON (s.track_id);


// CREATE IZMENI PODATKE
CREATE (:CollectionSong {
    track_id: 'cx12xzcklsa_d1k23lddasq23',
    track_name: 'Ne moze nam niko nista',
    track_artist: 'Mitar Miric',
    track_popularity: 0.12,
    track_album_id: 'dsad123cxzm213',
    track_album_name: 'Ne moze nam niko nista',
    track_album_release_date: '1989-03-31',
    playlist_name: 'Jaka plejlista',
    playlist_id: 'sajdlkajdl21n3jcxz',
    playlist_genre: 'Narodna',
    playlist_subgenre: 'Zabavna',
    danceability: 0.45,
    energy: 0.46,
    key: 2,
    loudness: 0.78,
    mode: 1,
    speechiness: 0.05,
    acousticness: 0.23,
    instrumentalness: 0.64,
    liveness: 0.77,
    valence: 0.43,
    tempo: 0.3,
    duration_ms: 360000
})

// READ 
MATCH (song:CollectionSong {track_id: 'cx12xzcklsa_d1k23lddasq23'})
RETURN song

// UPDATE
MATCH (song:CollectionSong {track_id: 'cx12xzcklsa_d1k23lddasq23'})
SET song.track_name = 'Moze nam svako svasta'
RETURN song

// DELETE
MATCH (song:CollectionSong {track_id: 'cx12xzcklsa_d1k23lddasq23'})
DELETE song

// CREATE IZMENI PODATKE
CREATE (:CollectionArtist {
    name: 'Mitar Miric',
    artist_id: '44213xzcasdk123s',
    artist_genre: 'Zabavna muzika',
    artist_popularity: 0.88
})

// READ
MATCH (artist:CollectionArtist {artist_id: '44213xzcasdk123s'})
RETURN artist

// UPDATE
MATCH (artist:CollectionArtist {artist_id: '44213xzcasdk123s'})
SET artist.name = 'Breskvica'
RETURN artist

// DELETE
MATCH (artist:CollectionArtist {artist_id: '44213xzcasdk123s'})
DELETE artist

// CREATE
CREATE (:CollectionAlbum {
    name: 'Tako mlada',
    album_id: 'xdak142ncxdldsa',
    album_artist: 'Tanja Savic',
    album_release_date: '2005-06-16',
    album_total_tracks: 8,
    album_popularity: 0.45
})

// READ
MATCH (album:CollectionAlbum {album_id: 'xdak142ncxdldsa'})
RETURN album

// UPDATE
MATCH (album:CollectionAlbum {album_id: 'xdak142ncxdldsa'})
SET album.name = 'Stranci'
RETURN album

// DELETE
MATCH (album:CollectionAlbum {album_id: 'xdak142ncxdldsa'})
DELETE album

// SINGLE VECTOR SEARCH
MATCH (song:CollectionSong)
WHERE song.track_popularity >= 70
RETURN song

// MULTI VECTOR SEARCH
MATCH (song:CollectionSong)
WHERE song.playlist_genre = 'rock' AND song.track_popularity >= 70
RETURN song.track_name as trackName

// FILTER
MATCH (song:CollectionSong)
WHERE song.energy >= 0.8
RETURN song

// COUNT
MATCH (song:CollectionSong)
WHERE song.playlist_genre = 'pop'
RETURN COUNT(song) AS NumPopSongs
